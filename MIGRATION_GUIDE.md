# Database Migration Guide: MongoDB to Supabase

This guide will help you migrate from MongoDB to Supabase for the RAMA AI backend.

## Overview

The backend has been successfully migrated from MongoDB (pymongo) to Supabase (PostgreSQL). This document outlines the changes and setup instructions.

## Changes Made

### 1. Dependencies Updated
- **Removed**: `pymongo`
- **Added**: `supabase`
- Updated: `requirements.txt`

### 2. Database Configuration
- **File**: `app/db.py`
- Changed from MongoDB client to Supabase client
- Environment variables required:
  - `SUPABASE_URL`
  - `SUPABASE_KEY`

### 3. Schema Created
- **File**: `schema.sql`
- Contains PostgreSQL schema for all tables:
  - `users` - User accounts
  - `elders` - Elder profiles
  - `younger` - Younger profiles
  - `chat_history` - Chat history
  - `reminders` - Medication reminders

### 4. Routes Updated
All route files have been updated to use Supabase instead of MongoDB:
- `app/routes/auth.py` - Authentication
- `app/routes/elders.py` - Elder profiles
- `app/routes/younger.py` - Younger profiles
- `app/routes/chat.py` - Chat functionality
- `app/routes/medications.py` - Medication reminders
- `app/main.py` - Main application

## Setup Instructions

### 1. Supabase Setup

1. Go to [Supabase](https://supabase.com) and create an account
2. Create a new project
3. Navigate to **SQL Editor** in your project dashboard
4. Run the SQL script from `schema.sql` to create all tables
5. Note your project URL and anon key from Settings â†’ API

### 2. Environment Variables

1. Create a `.env` file in the `backend` directory (use `.env.example` as template)
2. Add your Supabase credentials:

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_anon_key_here
JWT_SECRET=your_secret_key_here
JWT_ALGORITHM=HS256
```

### 3. Install Dependencies

```bash
cd backend
pip install -r requirements.txt
```

### 4. Run the Application

```bash
uvicorn app.main:app --reload
```

## Data Migration (Optional)

If you have existing data in MongoDB that you want to migrate:

1. Export data from MongoDB using `mongoexport` or a similar tool
2. Convert the JSON export to SQL INSERT statements
3. Run the SQL INSERT statements in Supabase SQL Editor

**Note**: UUIDs will be automatically generated by PostgreSQL

## Key Differences

### MongoDB vs Supabase
- **MongoDB**: Document-based, uses `_id` (ObjectId)
- **Supabase**: Relational (PostgreSQL), uses `id` (UUID)

### Query Changes
- **MongoDB**: `collection.find_one({"field": "value"})`
- **Supabase**: `table.select("*").eq("field", "value").execute()`

### Updates
- **MongoDB**: `update_one({"_id": id}, {"$set": data})`
- **Supabase**: `table.update(data).eq("id", id).execute()`

## Testing

1. Start the server
2. Test the connection: `GET http://localhost:8000/check-db`
3. Test authentication: `POST http://localhost:8000/auth/signup`
4. Test other endpoints as needed

## Troubleshooting

### Connection Errors
- Verify `SUPABASE_URL` and `SUPABASE_KEY` in `.env`
- Check that tables exist in Supabase dashboard
- Ensure Row Level Security (RLS) is disabled or properly configured

### Import Errors
- Make sure you've installed all dependencies: `pip install -r requirements.txt`
- Check that the `supabase` package is installed correctly

### Query Errors
- Verify table names match exactly (case-sensitive)
- Check that required fields are present in the database schema

## Support

For issues or questions:
- Supabase documentation: https://supabase.com/docs
- Python client: https://github.com/supabase/supabase-py


